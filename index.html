<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digit Recognizer</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      background-color: #eef;
    }
    canvas {
      border: 2px solid #333;
      background-color: #fff;
      cursor: crosshair;
    }
  </style>
</head>
<body>
  <h1>Draw a Digit (0–9)</h1>
  <canvas id="canvas" width="256" height="256"></canvas>
  <br><br>
  <button onclick="clearCanvas()">Clear</button>
  <button onclick="recognize()">Recognize</button>
  <h2 id="result">Prediction: ...</h2>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    ctx.lineWidth = 15;
    ctx.lineCap = 'round';
    let drawing = false;

    canvas.addEventListener('mousedown', (e) => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });
    canvas.addEventListener('mousemove', (e) => {
      if (drawing) {
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
      }
    });
    canvas.addEventListener('mouseup', () => {
      drawing = false;
    });

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('result').innerText = 'Prediction: ...';
    }

    let model;
    async function loadModel() {
      model = await tf.loadLayersModel('https://jaquoya.github.io/Models/model.json');
      console.log('✅ Model loaded');
    }

    async function recognize() {
      if (!model) return alert('Model not loaded yet!');

      // Resize drawing to 64x64 grayscale
      const temp = document.createElement('canvas');
      temp.width = 64;
      temp.height = 64;
      const tempCtx = temp.getContext('2d');
      tempCtx.drawImage(canvas, 0, 0, 64, 64);

      const imgData = tempCtx.getImageData(0, 0, 64, 64);
      const input = [];
      for (let i = 0; i < imgData.data.length; i += 4) {
        const grayscale = (imgData.data[i] + imgData.data[i + 1] + imgData.data[i + 2]) / 3;
        input.push(grayscale / 255); // Normalize
      }

      const tensor = tf.tensor(input, [1, 64, 64, 1]);
      const prediction = model.predict(tensor);
      const result = (await prediction.argMax(1).data())[0];
      document.getElementById('result').innerText = `Prediction: ${result}`;
    }

    loadModel();
  </script>
</body>
</html>
